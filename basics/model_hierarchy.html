
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Model Hierarchy &#8212; MPhys  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/style.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tagged Promotion" href="tagged_promotion.html" />
    <link rel="prev" title="Documentation for MPhys" href="../index.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tagged_promotion.html" title="Tagged Promotion"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../index.html" title="Documentation for MPhys"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">MPhys  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Model Hierarchy</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="model-hierarchy">
<h1>Model Hierarchy<a class="headerlink" href="#model-hierarchy" title="Permalink to this heading">¶</a></h1>
<p>MPhys uses a pattern to build multiphysics optimization problems.
Each level of the pattern is a different type of group that MPhys provides.</p>
<p>The highest level of the model is the multipoint group.
The multipoint group consist of scenarios which represent different conditions and/or types of multiphysics analyses to performed.
Within the scenario is the coupling group which represents the primary multiphysics problem for the scenario.</p>
<p><a class="reference internal" href="builders.html#builders"><span class="std std-ref">Builders</span></a> are used to help populate these levels of the model hierarchy with subsystems from the solvers.
<a class="reference internal" href="tagged_promotion.html#tagged-promotion"><span class="std std-ref">Tagged Promotion</span></a> is used to promote specific variables to the level of scenario.</p>
<section id="coupling-groups">
<span id="id1"></span><h2>Coupling Groups<a class="headerlink" href="#coupling-groups" title="Permalink to this heading">¶</a></h2>
<p>The CouplingGroup is the primary physics coupling being solved.
That is it contains physics modules, such as an aerodynamic or structural solver,
and potentially modules that transfer or interpolate between the physics modules, such as a load or displacement transfer schemes.</p>
<p>Each type of scenario typically has an associated coupling group that it will add automatically given the proper builders.
Within the Scenario group, the coupling group will have the name ‘coupling’.
The scenario-specific coupling group will have a default nonlinear and linear solvers,
but these can be overwritten with the optional arguments to <a class="reference internal" href="#mphys.multipoint.Multipoint.mphys_add_scenario" title="mphys.multipoint.Multipoint.mphys_add_scenario"><code class="xref py py-func docutils literal notranslate"><span class="pre">mphys_add_scenario()</span></code></a>.</p>
</section>
<section id="scenario-groups">
<span id="id2"></span><h2>Scenario Groups<a class="headerlink" href="#scenario-groups" title="Permalink to this heading">¶</a></h2>
<p>The scenario level is an OpenMDAO group that represents a specific condition in a multipoint optimization.
For example, a scenario could be a cruise flight condition that requires a coupling group to determine the lift and drag.
The scenario group contains a coupling group and any scenario-specific computation that needs to occur before or after the associated coupled problem is solved.
For example, a sonic boom propagator requires the flow solution as an input but this one-way coupling does not require it to be in the coupling group; therefore, it should be put in the scenario group to be solved after the coupling group converges.</p>
<p>MPhys provides a library of these Scenario groups designed for specific type problems.
See <a class="reference internal" href="../index.html#scenario-library"><span class="std std-ref">MPhys Scenario Library</span></a> for details about specific standardized scenarios.
If a particular multiphysics problem is not covered by the MPhys library, new scenarios and coupling groups can be created by subclassing the <a class="reference internal" href="../developers/mphys_group.html#mphys.mphys_group.MphysGroup" title="mphys.mphys_group.MphysGroup"><code class="xref py py-class docutils literal notranslate"><span class="pre">MphysGroup</span></code></a>.</p>
</section>
<section id="multipoint-groups">
<h2>Multipoint Groups<a class="headerlink" href="#multipoint-groups" title="Permalink to this heading">¶</a></h2>
<p>There are two versions of the multipoint group:</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">Multipoint</span></code> is derived from the standard OpenMDAO <code class="docutils literal notranslate"><span class="pre">Group</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">MultipointParallel</span></code> is derived for the OpenMDAO <code class="docutils literal notranslate"><span class="pre">ParallelGroup</span></code>.</p></li>
</ol>
<p>For both versions have a function,  <a class="reference internal" href="#mphys.multipoint.Multipoint.mphys_add_scenario" title="mphys.multipoint.Multipoint.mphys_add_scenario"><code class="xref py py-func docutils literal notranslate"><span class="pre">mphys_add_scenario()</span></code></a>, is used to populate
the lower levels of the model hierarchy.</p>
<section id="multipoint">
<h3>Multipoint<a class="headerlink" href="#multipoint" title="Permalink to this heading">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">Multipoint</span></code> group will sequentially evaluate the scenario groups.
The <code class="docutils literal notranslate"><span class="pre">Multipoint</span></code> group can be the top group of the OpenMDAO model or a subsystem.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">setup</span></code> method of the Multipoint group, the following steps must be done:</p>
<ol class="arabic simple">
<li><p>Instantiate the builders</p></li>
<li><p>Call <a class="reference internal" href="builders.html#mphys.builder.Builder.initialize" title="mphys.builder.Builder.initialize"><code class="xref py py-func docutils literal notranslate"><span class="pre">initialize()</span></code></a> for each builder with the Multipoint’s comm (<code class="docutils literal notranslate"><span class="pre">self.comm</span></code>)</p></li>
<li><p>Add the mesh components and/or other mesh coordinate source like geometry.</p></li>
<li><p>Add the scenarios</p></li>
<li><p>Connect the mesh coordinates to the scenarios</p></li>
</ol>
<p>Additionally, the Multipoint group can hold the design variables or other inputs and subsystems to be evaluated after the scenarios.
These extra subsystem can then be connected to the scenarios by the user.</p>
<span class="target" id="module-mphys.multipoint"></span><dl class="py class">
<dt class="sig sig-object py" id="mphys.multipoint.Multipoint">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mphys.multipoint.</span></span><span class="sig-name descname"><span class="pre">Multipoint</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mphys/multipoint.html#Multipoint"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mphys.multipoint.Multipoint" title="Permalink to this definition">¶</a></dt>
<dd><p>An extension of the standard OpenMDAO group that adds the <a class="reference internal" href="#mphys.multipoint.Multipoint.mphys_add_scenario" title="mphys.multipoint.Multipoint.mphys_add_scenario"><code class="xref py py-func docutils literal notranslate"><span class="pre">mphys_add_scenario()</span></code></a> method.
For sequential evaluations of the MPhys scenarios.</p>
<p>Set the solvers to nonlinear and linear block Gauss–Seidel by default.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mphys.multipoint.Multipoint.mphys_add_scenario">
<span class="sig-name descname"><span class="pre">mphys_add_scenario</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scenario</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coupling_nonlinear_solver</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coupling_linear_solver</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mphys/multipoint.html#Multipoint.mphys_add_scenario"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mphys.multipoint.Multipoint.mphys_add_scenario" title="Permalink to this definition">¶</a></dt>
<dd><p>Add an MPhys scenario</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>name</strong><span class="classifier">str</span></dt><dd><p>The name of the scenario</p>
</dd>
<dt><strong>Scenario: :class:`~mphys.scenario.Scenario`</strong></dt><dd><p>The scenario object</p>
</dd>
<dt><strong>coupling_nonlinear_solver: openmdao.solvers.solver.NonlinearSolver</strong></dt><dd><p>The nonlinear solver to assign to the coupling group primal problem</p>
</dd>
<dt><strong>coupling_linear_solver: openmdao.solvers.solver.LinearSolver</strong></dt><dd><p>The linear solver to to assign to the coupling group sensitivity problem</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mphys.multipoint.Multipoint.mphys_connect_scenario_coordinate_source">
<span class="sig-name descname"><span class="pre">mphys_connect_scenario_coordinate_source</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">source</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scenarios</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">disciplines</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mphys/multipoint.html#Multipoint.mphys_connect_scenario_coordinate_source"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mphys.multipoint.Multipoint.mphys_connect_scenario_coordinate_source" title="Permalink to this definition">¶</a></dt>
<dd><p>A helper method to aid in connecting mesh coordinate sources to the scenarios
in this multipoint group.
The source and target variable names are assumed to be <cite>‘x_{discipline}0’</cite></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>source: openmdao.api.Group or openmdao.api.Component</strong></dt><dd><p>The source subsystem for the mesh coordinate variables</p>
</dd>
<dt><strong>scenarios</strong><span class="classifier">str or list[str]</span></dt><dd><p>The names of the scenarios to be the target of the connections</p>
</dd>
<dt><strong>disciplines</strong><span class="classifier">str or list[str]</span></dt><dd><p>The names of the disciplines for the mesh coordinates.</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
<section id="multipointparallel">
<h3>MultipointParallel<a class="headerlink" href="#multipointparallel" title="Permalink to this heading">¶</a></h3>
<p>If given a number of MPI ranks greater than or equal to the number of scenarios, the <code class="docutils literal notranslate"><span class="pre">MultipointParallel</span></code> group will simultaneously evaluate the scenario groups.
Unlike the sequential Multipoint group, the MPI communicators are different for each scenario in MultipointParallel, so the scenarios will call the builder’s initialize method.</p>
<p>In the <code class="docutils literal notranslate"><span class="pre">setup</span></code> method of the <code class="docutils literal notranslate"><span class="pre">MultipointParallel</span></code> group, the following steps must be done:</p>
<ol class="arabic simple">
<li><p>Instantiate the builders</p></li>
<li><p>Add the scenarios using the <code class="code docutils literal notranslate"><span class="pre">in_MultipointParallel=True</span></code> option</p></li>
</ol>
<p>Because this is a ParallelGroup, other subsystems that hold the inputs outside the scenario and subsystems to be evaluated after the scenarios cannot be added directly to the MultipointParallel group.
These extra subsystem should be added to a higher level of the model and then connected to the scenarios by the user.</p>
<dl class="py class">
<dt class="sig sig-object py" id="mphys.multipoint.MultipointParallel">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">mphys.multipoint.</span></span><span class="sig-name descname"><span class="pre">MultipointParallel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mphys/multipoint.html#MultipointParallel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mphys.multipoint.MultipointParallel" title="Permalink to this definition">¶</a></dt>
<dd><p>An OpenMDAO parallel group that adds the <a class="reference internal" href="#mphys.multipoint.MultipointParallel.mphys_add_scenario" title="mphys.multipoint.MultipointParallel.mphys_add_scenario"><code class="xref py py-func docutils literal notranslate"><span class="pre">mphys_add_scenario()</span></code></a> method.
For simultaneous evaluations of the MPhys scenarios.</p>
<p>Set the mpi_proc_allocator option to ‘parallel’.</p>
<dl class="py method">
<dt class="sig sig-object py" id="mphys.multipoint.MultipointParallel.mphys_add_scenario">
<span class="sig-name descname"><span class="pre">mphys_add_scenario</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scenario</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coupling_nonlinear_solver</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">coupling_linear_solver</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mphys/multipoint.html#MultipointParallel.mphys_add_scenario"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mphys.multipoint.MultipointParallel.mphys_add_scenario" title="Permalink to this definition">¶</a></dt>
<dd><p>Add an MPhys scenario</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><dl class="simple">
<dt><strong>name</strong><span class="classifier">str</span></dt><dd><p>The name of the scenario</p>
</dd>
<dt><strong>Scenario: :class:`~mphys.scenario.Scenario`</strong></dt><dd><p>The scenario object</p>
</dd>
<dt><strong>coupling_nonlinear_solver: openmdao.solvers.solver.NonlinearSolver</strong></dt><dd><p>The nonlinear solver to assign to the coupling group primal problem</p>
</dd>
<dt><strong>coupling_linear_solver: openmdao.solvers.solver.LinearSolver</strong></dt><dd><p>The linear solver to to assign to the coupling group sensitivity problem</p>
</dd>
</dl>
</dd>
</dl>
</dd></dl>

</dd></dl>

</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <div>
    <h3><a href="../index.html">Table of Contents</a></h3>
    <ul>
<li><a class="reference internal" href="#">Model Hierarchy</a><ul>
<li><a class="reference internal" href="#coupling-groups">Coupling Groups</a></li>
<li><a class="reference internal" href="#scenario-groups">Scenario Groups</a></li>
<li><a class="reference internal" href="#multipoint-groups">Multipoint Groups</a><ul>
<li><a class="reference internal" href="#multipoint">Multipoint</a><ul>
<li><a class="reference internal" href="#mphys.multipoint.Multipoint"><code class="docutils literal notranslate"><span class="pre">Multipoint</span></code></a><ul>
<li><a class="reference internal" href="#mphys.multipoint.Multipoint.mphys_add_scenario"><code class="docutils literal notranslate"><span class="pre">Multipoint.mphys_add_scenario()</span></code></a></li>
<li><a class="reference internal" href="#mphys.multipoint.Multipoint.mphys_connect_scenario_coordinate_source"><code class="docutils literal notranslate"><span class="pre">Multipoint.mphys_connect_scenario_coordinate_source()</span></code></a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#multipointparallel">MultipointParallel</a><ul>
<li><a class="reference internal" href="#mphys.multipoint.MultipointParallel"><code class="docutils literal notranslate"><span class="pre">MultipointParallel</span></code></a><ul>
<li><a class="reference internal" href="#mphys.multipoint.MultipointParallel.mphys_add_scenario"><code class="docutils literal notranslate"><span class="pre">MultipointParallel.mphys_add_scenario()</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  </div>
<h3><a href="../index.html">Table of Contents</a></h3>
<p class="caption" role="heading"><span class="caption-text">MPhys Basics</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Model Hierarchy</a></li>
<li class="toctree-l1"><a class="reference internal" href="tagged_promotion.html">Tagged Promotion</a></li>
<li class="toctree-l1"><a class="reference internal" href="builders.html">Builders</a></li>
<li class="toctree-l1"><a class="reference internal" href="naming_conventions.html">Variable Naming Conventions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Multiphysics Scenarios</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scenarios/aerostructural.html">Aerostructural Scenario</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Single Discipline Scenarios</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../scenarios/structural.html">Structural Scenario</a></li>
<li class="toctree-l1"><a class="reference internal" href="../scenarios/aerodynamic.html">Aerodynamic Scenario</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developers Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../developers/mphys_group.html">The MphysGroup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../developers/new_multiphysics_problems.html">Extending the Scenario Library</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="tagged_promotion.html" title="Tagged Promotion"
             >next</a> |</li>
        <li class="right" >
          <a href="../index.html" title="Documentation for MPhys"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">MPhys  documentation</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">Model Hierarchy</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, NASA.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 6.1.3.
    </div>
  </body>
</html>